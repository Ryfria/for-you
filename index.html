<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Clean Full Screen</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: sans-serif; touch-action: none; }
        
        /* CANVAS FULL SCREEN */
        #canvas-container { width: 100vw; height: 100vh; display: block; position: fixed; top: 0; left: 0; z-index: 1; }

        /* VIDEO PREVIEW KECIL (Transparan) - Biar tau posisi tangan aja */
        #webcam-preview { 
            position: absolute; top: 20px; right: 20px; width: 80px; 
            opacity: 0.3; border-radius: 8px; transform: scaleX(-1); z-index: 10;
        } 

        /* LOADING INDICATOR */
        #loading {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: #fff; font-size: 16px; text-align: center; z-index: 20;
            text-shadow: 0 0 10px #00d2ff; pointer-events: none;
        }
    </style>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
</head>
<body>

    <video id="webcam-preview" playsinline muted autoplay></video>

    <div id="loading">
        <b>MEMUAT SISTEM...</b><br>
        Arahkan kamera ke tangan ðŸ‘‹
    </div>

    <div id="canvas-container"></div>
    <canvas id="textCanvas" width="1000" height="1000" style="display:none;"></canvas>

<script>
    const PARTICLE_COUNT = 6000; // Jumlah partikel pas buat HP
    
    let particles, geometry, material;
    let positions, targetPositions, colorsArray;
    let cacheIdle = [], cache1 = [], cache2 = [], cache3 = [], cache4 = [];
    let currentShapeType = 'idle';
    let lastDetectedShape = '';
    const tempColor = new THREE.Color();

    const scene = new THREE.Scene();
    scene.fog = new THREE.FogExp2(0x000000, 0.02);

    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    // Posisi kamera standar karena tidak ada menu yang menghalangi
    camera.position.z = 100; 
    camera.position.y = 0;   

    const renderer = new THREE.WebGLRenderer({ antialias: false, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(1);
    document.getElementById('canvas-container').appendChild(renderer.domElement);

    // --- GENERATOR TEKS ---
    function generateTextPoints(text) {
        const c = document.getElementById('textCanvas');
        const ctx = c.getContext('2d');
        ctx.clearRect(0,0,c.width,c.height);
        
        const fontSize = 80; // Font Lebih Besar biar kebaca
        
        ctx.fillStyle = '#ffffff'; 
        ctx.font = `900 ${fontSize}px Arial, sans-serif`;
        ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
        
        const lines = text.split('\n');
        const lineHeight = fontSize * 1.2;
        const startY = (c.height - ((lines.length - 1) * lineHeight)) / 2;

        lines.forEach((line, index) => {
            ctx.fillText(line, c.width/2, startY + (index * lineHeight));
        });
        
        const data = ctx.getImageData(0,0,c.width,c.height).data;
        const pts = [];
        const step = 6; 
        for(let y=0; y<c.height; y+=step) {
            for(let x=0; x<c.width; x+=step) {
                if(data[(y*c.width+x)*4] > 128) {
                    pts.push({ 
                        x: (x - c.width/2) * 0.18, 
                        y: ((c.height-y) - c.height/2) * 0.18, // TEPAT DI TENGAH
                        z: 0 
                    });
                }
            }
        }
        return pts;
    }

    function initParticles() {
        // Teks dibuat simple & besar
        cacheIdle = generateTextPoints("Hai\nKamu ðŸ‘‹");
        cache1 = generateTextPoints("Cantik\nBanget ðŸŒ¸"); // 1 Jari
        cache2 = generateTextPoints("Senyum\nDong ðŸ˜Š");   // 2 Jari
        cache3 = generateTextPoints("Makasih\nYa âœ¨");     // 3 Jari
        cache4 = generateTextPoints("Sehat\nSelalu ðŸ¤²");   // 4 Jari

        geometry = new THREE.BufferGeometry();
        positions = new Float32Array(PARTICLE_COUNT * 3);
        targetPositions = new Float32Array(PARTICLE_COUNT * 3);
        colorsArray = new Float32Array(PARTICLE_COUNT * 3);

        for(let i=0; i<PARTICLE_COUNT*3; i++) {
            positions[i] = (Math.random()-0.5) * 100;
            targetPositions[i] = positions[i];
        }

        geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        geometry.setAttribute('color', new THREE.BufferAttribute(colorsArray, 3));

        material = new THREE.PointsMaterial({
            size: 0.8, vertexColors: true, transparent: true, opacity: 1.0, 
            blending: THREE.AdditiveBlending, depthWrite: false
        });

        particles = new THREE.Points(geometry, material);
        scene.add(particles);
        calculateShape('idle');
    }

    function calculateShape(type) {
        currentShapeType = type;
        
        for (let i = 0; i < PARTICLE_COUNT; i++) {
            const i3 = i * 3;
            let x, y, z, hue;
            let pt;

            if (type === 'idle') {
                pt = cacheIdle[i % cacheIdle.length];
                x = pt.x; y = pt.y; z = pt.z + (Math.random()-0.5)*5;
                hue = 0.6; // Biru
            } 
            else if (type.startsWith('msg')) {
                let cache = type === 'msg1'?cache1 : type==='msg2'?cache2 : type==='msg3'?cache3 : cache4;
                pt = cache[i % cache.length];
                x = pt.x; y = pt.y; z = pt.z;
                hue = (x/100) + 0.5; // Pelangi
            } 
            else if (type === 'heart') {
                const t = Math.random() * Math.PI * 2;
                let hx = 18 * Math.pow(Math.sin(t), 3);
                let hy = 15 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
                
                x = hx * 1.5; y = (hy * 1.5) + 10; // Hati Besar di tengah
                z = (Math.random()-0.5)*5;
                hue = 0.0; // Merah
            } 
            else { x=0;y=0;z=0;hue=0; } 

            targetPositions[i3] = x;
            targetPositions[i3+1] = y;
            targetPositions[i3+2] = z;

            tempColor.setHSL(hue % 1, 1.0, 0.6);
            colorsArray[i3] = tempColor.r;
            colorsArray[i3+1] = tempColor.g;
            colorsArray[i3+2] = tempColor.b;
        }
        geometry.attributes.color.needsUpdate = true;
    }

    function animate() {
        requestAnimationFrame(animate);
        const pos = geometry.attributes.position.array;
        // Gerakan partikel smooth
        for(let i=0; i<PARTICLE_COUNT*3; i++) {
            pos[i] += (targetPositions[i] - pos[i]) * 0.1;
        }
        geometry.attributes.position.needsUpdate = true;
        renderer.render(scene, camera);
    }

    function onResults(results) {
        document.getElementById('loading').style.display = 'none';
        
        if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
            const lm = results.multiHandLandmarks[0];
            const isUp = (t, b) => lm[t].y < lm[b].y;
            
            let count = 0;
            if(isUp(8,6)) count++;
            if(isUp(12,10)) count++;
            if(isUp(16,14)) count++;
            if(isUp(20,18)) count++;
            if(lm[4].x < lm[3].x) count++; 

            if(count > 5) count = 5;

            // Logic Ubah Teks tanpa UI Panel
            let shape = 'idle';
            if(count===1) shape='msg1';
            else if(count===2) shape='msg2';
            else if(count===3) shape='msg3';
            else if(count===4) shape='msg4';
            else if(count===5) shape='heart';

            if(shape !== lastDetectedShape) {
                lastDetectedShape = shape;
                calculateShape(shape);
            }
        } else {
            // Kalau tidak ada tangan, kembali ke text awal
            if(lastDetectedShape !== 'idle') {
                lastDetectedShape = 'idle';
                calculateShape('idle');
            }
        }
    }

    const videoElement = document.getElementById('webcam-preview');
    const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
    hands.setOptions({ maxNumHands: 1, modelComplexity: 0, minDetectionConfidence: 0.3, minTrackingConfidence: 0.4 });
    hands.onResults(onResults);

    const cameraUtils = new Camera(videoElement, {
        onFrame: async () => { await hands.send({image: videoElement}); },
        width: 480, height: 360, facingMode: 'user'
    });

    initParticles();
    cameraUtils.start();
    animate();

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
</script>
</body>
</html>
